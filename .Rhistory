axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
full_model_plot
ggsave(
plot = full_model_plot,
filename = "plots/full_model_plot.png",
dpi = 5e2,
width = 2 * 5,
height = 1 * 5,
units = "in",
bg = NULL
)
ggsave(
plot = gg_tsresiduals(full_model),
filename = "plots/full_model_diagnostics.png",
dpi = 5e2,
width = 3 * 5,
height = 2 * 5,
units = "in",
bg = NULL
)
human_only_plot
metrics
results <- tsFunction(train, test, max_lag = 6)
metrics <- map_dfr(results, ~calculate_metrics(.$forecast))
View(metrics)
metrics
fc_full
# Plotting for the Best model at lag 1
best_train_model_plot <- ggplot() +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d2, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2022 Dec")), linetype = 2) +
geom_line(data  = results[[2]]$fitted, aes(x = date, y = .fitted, color = "Predicted human incidence"), linewidth = .7) +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = results[[2]]$forecast, aes(date, forecast_hum_incidence, color = "Forecasted human incidence"))+
scale_color_manual(
values = c(
"Predicted human incidence" = "blue",
"Observed human incidence" = "black",
'Forecasted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
best_train_model_plot
d2
max(d2$date)
# Plotting for the Best model at lag 1
best_train_model_plot <- ggplot() +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d1, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2022 Dec")), linetype = 2) +
geom_line(data  = results[[2]]$fitted, aes(x = date, y = .fitted, color = "Predicted human incidence"), linewidth = .7) +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = results[[2]]$forecast, aes(date, forecast_hum_incidence, color = "Forecasted human incidence"))+
scale_color_manual(
values = c(
"Predicted human incidence" = "blue",
"Observed human incidence" = "black",
'Forecasted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
best_train_model_plot
# Plotting for the Best model at lag 1
best_train_model_plot <- ggplot() +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d1, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2021 Mar")), linetype = 2) +
geom_line(data  = results[[2]]$fitted, aes(x = date, y = .fitted, color = "Predicted human incidence"), linewidth = .7) +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = results[[2]]$forecast, aes(date, forecast_hum_incidence, color = "Forecasted human incidence"))+
scale_color_manual(
values = c(
"Predicted human incidence" = "blue",
"Observed human incidence" = "black",
'Forecasted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
best_train_model_plot
ggsave(
plot = best_train_model_plot,
filename = "plots/best_train_model_plot.png",
dpi = 5e2,
width = 2 * 5,
height = 1 * 5,
units = "in",
bg = NULL
)
tag_levels = list(c("", "(a)", "(b)))
ggsave(
plot = wrap_plots(human_only_plot, best_train_model_plot) &
plot_annotation(
title = "",
tag_levels = list(c("", "(a)", "(b)"))
wrap_plots(human_only_plot, best_train_model_plot) &
plot_annotation(
title = "",
tag_levels = list(c("", "(a)", "(b)"))
)
ggsave(
plot = wrap_plots(human_only_plot, best_train_model_plot, nrow = 2) &
plot_annotation(
title = "",
tag_levels = list(c("", "(a)", "(b)"))
) ,
filename = "plots/train_models_plot.png",
dpi = 5e2,
width = 3 * 5,
height = 2 * 5,
units = "in",
bg = NULL
)
# Plotting for the Best model at lag 1
best_train_model_plot <- ggplot() +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d1, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2021 Mar")), linetype = 2) +
geom_line(data  = results[[2]]$fitted, aes(x = date, y = .fitted, color = "Fitted human incidence"), linewidth = .7) +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = results[[2]]$forecast, aes(date, forecast_hum_incidence, color = "Predicted human incidence"))+
scale_color_manual(
values = c(
"Fitted human incidence" = "blue",
"Observed human incidence" = "black",
'Predicted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
best_train_model_plot
ggsave(
plot = best_train_model_plot,
filename = "plots/best_train_model_plot.png",
dpi = 5e2,
width = 2 * 5,
height = 1 * 5,
units = "in",
bg = NULL
)
human_only_plot
human_only_plot <- ggplot() +
geom_ribbon(data = fc_hum, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d1, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2021 Mar")), linetype = 2) +
geom_line(data  = fitted_hum, aes(x = date, y = .fitted, color = "Fitted human incidence"), linewidth = .7) +
geom_ribbon(data = fc_hum, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = fc_hum, aes(date, forecast_hum_incidence, color = "Predicted human incidence"))+
scale_color_manual(
values = c(
"Fitted human incidence" = "blue",
"Observed human incidence" = "black",
'Predicted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
ggsave(
plot = human_only_plot,
filename = "plots/human_only_plot.png",
dpi = 5e2,
width = 2 * 5,
height = 1 * 5,
units = "in",
bg = NULL
)
results <- tsFunction(train, test, max_lag = 6)
metrics <- map_dfr(results, ~calculate_metrics(.$forecast))
fc_full <-  hilo(forecast::forecast(full_model,  new_data = test2)) |>
as.data.frame() %>%
mutate(
lower_80 = `80%`$lower,
upper_80 = `80%`$upper,
lower_95 = `95%`$lower,
upper_95 = `95%`$upper,
actual_hum_incidence = test2$hum_incidence,
.mean = round(.mean, 3)
) |>
select(date, forecast_hum_incidence  = .mean, actual_hum_incidence, lower_80, upper_80, lower_95, upper_95, )
full_model_plot <- ggplot() +
geom_ribbon(data = fc_full, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2022 Dec")), linetype = 2) +
geom_line(data  = fitted_full, aes(x = date, y = .fitted, color = "Predicted human incidence"), linewidth = .7) +
geom_ribbon(data = fc_full, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = fc_full, aes(date, forecast_hum_incidence, color = "Forecasted human incidence"))+
scale_color_manual(
values = c(
"Predicted human incidence" = "blue",
"Observed human incidence" = "black",
'Forecasted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
ggsave(
plot = full_model_plot,
filename = "plots/full_model_plot.png",
dpi = 5e2,
width = 2 * 5,
height = 1 * 5,
units = "in",
bg = NULL
)
# Plotting for the Best model at lag 1
best_train_model_plot <- ggplot() +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d1, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2021 Mar")), linetype = 2) +
geom_line(data  = results[[2]]$fitted, aes(x = date, y = .fitted, color = "Fitted human incidence"), linewidth = .7) +
geom_ribbon(data = results[[2]]$forecast, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = results[[2]]$forecast, aes(date, forecast_hum_incidence, color = "Predicted human incidence"))+
scale_color_manual(
values = c(
"Fitted human incidence" = "blue",
"Observed human incidence" = "black",
'Predicted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
ggsave(
plot = best_train_model_plot,
filename = "plots/best_train_model_plot.png",
dpi = 5e2,
width = 2 * 5,
height = 1 * 5,
units = "in",
bg = NULL
)
ggsave(
plot = wrap_plots(human_only_plot, best_train_model_plot, nrow = 2) &
plot_annotation(
title = "",
tag_levels = list(c("", "(a)", "(b)"))
) ,
filename = "plots/train_models_plot.png",
dpi = 5e2,
width = 3 * 5,
height = 2 * 5,
units = "in",
bg = NULL
)
wrap_plots(human_only_plot, best_train_model_plot, nrow = 2) &
plot_annotation(
title = "",
tag_levels = list(c("", "(a)", "(b)"))
)
ggsave(
plot = wrap_plots(human_only_plot, best_train_model_plot, nrow = 2) &
plot_annotation(
title = "",
tag_levels = list(c("(a)", "(b)"))
) ,
filename = "plots/train_models_plot.png",
dpi = 5e2,
width = 3 * 5,
height = 2 * 5,
units = "in",
bg = NULL
)
human_only_plot
test2 <- d2 |>
filter(date > yearmonth("2022-12-01"))
full_model <- d2 |>
filter(date <= yearmonth("2022-12-01")) |>
as_tsibble(index = date) |>
model(ARIMA(hum_incidence, ic = "aic", stepwise = T))
fitted_full <- augment(full_model) |>
select(-.model)
full_hilo <- hilo(forecast::forecast(full_model, new_data = test2 |> select(-hum_incidence)))
fc_full <-  hilo(forecast::forecast(full_model,  new_data = test2)) |>
as.data.frame() %>%
mutate(
lower_80 = `80%`$lower,
upper_80 = `80%`$upper,
lower_95 = `95%`$lower,
upper_95 = `95%`$upper,
actual_hum_incidence = test2$hum_incidence,
.mean = round(.mean, 3)
) |>
select(date, forecast_hum_incidence  = .mean, actual_hum_incidence, lower_80, upper_80, lower_95, upper_95, )
full_model_plot <- ggplot() +
geom_ribbon(data = fc_full, aes(date, ymin = lower_95, ymax = upper_95, fill = "95% CI"), alpha = 0.1) +
geom_line(data  = d, aes(x = date, y = hum_incidence, colour = "Observed human incidence"), linewidth = .7) +
geom_vline(xintercept = as.Date(yearmonth("2022 Dec")), linetype = 2) +
geom_line(data  = fitted_full, aes(x = date, y = .fitted, color = "Predicted human incidence"), linewidth = .7) +
geom_ribbon(data = fc_full, aes(date, ymin = lower_80, ymax = upper_80, fill = "80% CI"), alpha = 0.4) +
geom_line(data = fc_full, aes(date, forecast_hum_incidence, color = "Forecasted human incidence"))+
scale_color_manual(
values = c(
"Predicted human incidence" = "blue",
"Observed human incidence" = "black",
'Forecasted human incidence' = 'red'
)
) +
scale_fill_manual(
values = c("95% CI" = "blue", "80% CI" = "blue"),
guide = guide_legend(override.aes = list(alpha = c(0.25, 1)))
) +
labs(col = NULL, fill = NULL) +
theme_minimal() +
theme(
axis.text = element_text(color = "black"),
axis.title = element_text(color = "black"),
axis.ticks = element_line(color = "black"),
legend.position = "bottom",
plot.title = element_text(color = "black", hjust = .5),
legend.text = element_text(color = "black")
) +
labs(x = "Date", y = "Incidence")
full_model_plot
ggsave(
plot = full_model_plot,
filename = "plots/full_model_plot.png",
dpi = 5e2,
width = 2 * 5,
height = 1 * 5,
units = "in",
bg = NULL
)
model_human |> report()
# loading my package
library(dplyr)
# loading my data
data1 <- read.csv("Data/practise-sessions.csv")
# loading my data
data1 <- read.csv("~/Downloads/practise-sessions.csv")
# Selecting columns using the pipe %>%
cholera_data <- data1 %>%
select(county, subcounty, ward, cholera_cases)
View(cholera_data)
# Selecting columns using the pipe %>% and also filtering
nairobi_data <- data1 %>%
select(county, subcounty, ward, cholera_cases) %>%
filter(county == "Nairobi")
View(nairobi_data)
# Selecting columns using the pipe %>% and also filtering
nairobi_data <- data1 %>%
select(county, subcounty, ward, cholera_cases) %>%
filter(!county == "Nairobi")
animal_data <- read.csv("~/Desktop/kabs_2021_data.csv")
# Working with KABS data
View(animal_data)
dim(animal_data)
animal_data$species
unique(animal_data$species)
unique(animal_data$disease_condition)
animal_data$species
unique(animal_data$species)
unique(animal_data$disease_condition)
unique(animal_data$year)
# How many cases per species
cases_per_species <- animal_data %>%
group_by(species) %>%
summarise(cases = sum(no_sick))
print(cases_per_species)
# How many cases per species
cases_per_species <- animal_data %>%
group_by(species) %>%
summarise(cases_2021 = sum(no_sick))
print(cases_per_species)
# How many cases per species
cases_per_species <- animal_data %>%
group_by(species) %>%
summarise(cases = sum(no_sick))
print(cases_per_species)
View(cases_per_species)
# How many cases per species
cases_per_species <- animal_data %>%
group_by(species) %>%
summarise(cases = sum(no_sick)) %>%
View()
# How many cases per county
cases_per_county <- animal_data %>%
group_by(county) %>%
summarise(cases_per_county = sum(no_sick))
print(cases_per_county)
View(cases_per_county)
# How many cases, minimum, maximum, per county
cases_per_county2 <- animal_data %>%
group_by(county) %>%
summarise(
cases_per_county = sum(no_sick),
minimum_cases = min(no_sick),
maximum_cases = max(no_sick)
)
View(cases_per_county2)
# How many cases, minimum, maximum, per county
cases_per_min_max_county <- animal_data %>%
group_by(county) %>%
summarise(
cases_per_county = sum(no_sick),
minimum_cases = min(no_sick),
maximum_cases = max(no_sick)
)
View(cases_per_min_max_county)
# How many cases per month per disease condtion
cases_per_month_per_disease <- animal_data %>%
group_by(month, disease_condition) %>%
summarise(cases = sum(no_sick))
View(cases_per_month_per_disease)
# How many cases per  disease condtion month
cases_per_disease_per_month <- animal_data %>%
group_by(disease_condition, month) %>%
summarise(cases = sum(no_sick))
View(cases_per_disease_per_month)
# How many cases per county, disease condition and month
cases_county_disease_month <- animal_data %>%
group_by(county, disease_condition, month) %>%
summarise(cases = sum(no_sick))
View(cases_county_disease_month)
q()
